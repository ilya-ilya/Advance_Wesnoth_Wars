#textdomain aww
### 9. LEVEL-UP AMLA RANDOM BONUSES
# Author: Ruvaak, Toranks
# Original Creation
# tests: unit advances=9
# weird : the assignation of new trait in pre advance/avance event make a infinite loop. so splitted in 2 events.
# 1 event  + see event aww_00_trigger_pre_advance_common
# 1 unit variable used : aww_pre_advances_to
# will imply stat increases or new/updated abilities / weapon specials

#ifndef NON_FATAL_WOUNDS_EXTENDED
[event]
    name=post_advance
    id=aww_09_trigger_post_advance_amla_extra_bonus
    first_time_only=no
    [filter_condition]
        {AWW_ENABLED_FEATURE_09}
        {AWW_TEST_WAS_AMLA}
    [/filter_condition]
    [fire_event]
        name=aww_09_bonus_selection
        [primary_unit]
            x,y=$x1,$y1
        [/primary_unit]
    [/fire_event]
    [unit_overlay]
        {AWW_FILTER_CAN_BE_PROMOTED}
        {AWW_EVENT_UNIT}
        [not]
            [filter_wml]
                [variables]
                    aww_amla_icon=yes
                [/variables]
            [/filter_wml]
        [/not]
        image=misc/aww-leader-bonus-bronze.png
    [/unit_overlay]
    [modify_unit]
        [filter]
            {AWW_FILTER_CAN_BE_PROMOTED}
            {AWW_EVENT_UNIT}
        [/filter]
        [variables]
            aww_amla_icon=yes
        [/variables]
    [/modify_unit]
[/event]
#endif

[event]
    name=aww_09_bonus_selection
    first_time_only=no

    {VARIABLE_OP rand_bonus rand(1..33)}

    [switch]
        variable=rand_bonus

        ## Max melee/ranged damage/hits :
        [case]
            value=1,12,21
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    [has_attack]
                        range=melee
                        formula="number > 2"
                    [/has_attack]
                [/have_unit]
                [then]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_melee_damage_object
                            take_only_once=no
                            duration=forever
                            [effect]
                                apply_to=attack
                                range=melee
                                increase_damage=3
                            [/effect]
                        [/object]
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"melee"+": "+_"damage"+" +3" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Melee damage"+" +3"
                    [/message]
                [/then]
                [else]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/else]
            [/if]
        [/case]
        [case]
            value=2,11,23
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    [has_attack]
                        range=ranged
                        formula="number > 2"
                    [/has_attack]
                [/have_unit]
                [then]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_ranged_damage_object
                            take_only_once=no
                            duration=forever
                            [effect]
                                apply_to=attack
                                range=ranged
                                increase_damage=2
                            [/effect]
                        [/object]
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"ranged"+": "+_"damage"+" +2" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Ranged damage"+" +2"
                    [/message]
                [/then]
                [else]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/else]
            [/if]
        [/case]

        [case]
            value=3,25,18
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    [has_attack]
                        range=melee
                        formula="number < 4"
                    [/has_attack]
                [/have_unit]
                [then]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_melee_strike_object
                            take_only_once=no
                            duration=forever
                            [effect]
                                apply_to=attack
                                range=melee
                                increase_attacks=1
                            [/effect]
                        [/object]
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"melee"+": "+_"strikes"+" +1" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Melee strikes"+" +1"
                    [/message]
                [/then]
                [else]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/else]
            [/if]
        [/case]
        [case]
            value=4,26,28
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    [has_attack]
                        range=ranged
                        formula="number < 4"
                    [/has_attack]
                [/have_unit]
                [then]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_ranged_strike_object
                            take_only_once=no
                            duration=forever
                            [effect]
                                apply_to=attack
                                range=ranged
                                increase_attacks=1
                            [/effect]
                        [/object]
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"ranged"+": "+_"strikes"+" +1" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Ranged strikes"+" +1"
                    [/message]
                [/then]
                [else]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/else]
            [/if]
        [/case]

        # Max Moves +1 :

        [case]
            value=5,15,27
            [modify_unit]
                {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                [object]
                    id=aww_amla_movement_points_object
                    take_only_once=no
                    duration=forever
                    [effect]
                        apply_to=movement
                        increase=1
                    [/effect]
                [/object]
            [/modify_unit]
            {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"Moves"+" +1" {AWW_COLOR_AMLA}}
            [message]
                speaker=unit
                message= _ "Movement points"+" +1"
            [/message]
        [/case]

        ## New Abilities (only one by id, previous always keeped) :

        [case]
            value=6
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    ability_type=leadership
                [/have_unit]
                [or]
                    [have_unit]
                        x,y=$x1,$y1
                        level=0,1,2
                    [/have_unit]
                [/or]
                [or]
                    {AWW_ENABLED_FEATURE_15}
                    [and]
                        [have_unit]
                            x,y=$x1,$y1
                            level=0,1,2,3,4
                        [/have_unit]
                    [/and]
                [/or]
                [then]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/then]
                [else]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_leadership_object
                            duration=forever
                            [effect]
                                apply_to=new_ability
                                [abilities]
                                    {AWW_AMLA_LEADERSHIP_CAPPED $aww_leadership_level}
                                [/abilities]
                            [/effect]
                        [/object]
                        [set_variable]
                            name=aww_amla_has_leadership
                            value=yes
                        [/set_variable]
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"Leadership" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Leadership"
                    [/message]
                [/else]
            [/if]
        [/case]
        [case]
            value=7
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    ability=distract
                [/have_unit]
                [or]
                    [have_unit]
                        x,y=$x1,$y1
                        [filter_wml]
                            [modifications]
                                [object]
                                    id=aww_amla_distract_object
                                [/object]
                            [/modifications]
                        [/filter_wml]
                    [/have_unit]
                [/or]
                [then]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/then]
                [else]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_distract_object
                            duration=forever
                            {AWW_ABILITY_EFFECT_DISTRACT}
                        [/object]
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"Distract" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Distract"
                    [/message]
                [/else]
            [/if]
        [/case]
        [case]
            value=17
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    ability_type=regenerate
                [/have_unit]
                [then]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/then]
                [else]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_regen_object
                            duration=forever
                            {AWW_ABILITY_EFFECT_CUSTOM_REGEN 4 slowed}
                        [/object]
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"Regenerates" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Regenerates"
                    [/message]
                [/else]
            [/if]
        [/case]

        ## Weapons Specials (need to delete previous one before adding it - or detect if already existing, but slower process) :

        [case]
            value=8
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    [has_attack]
                        special_type=firststrike
                    [/has_attack]
                [/have_unit]
                [or]
                    [have_unit]
                        x,y=$x1,$y1
                        [has_attack]
                            formula="number > 3"
                        [/has_attack]
                    [/have_unit]
                    [and]
                        [not]
                            [have_unit]
                                x,y=$x1,$y1
                                [has_attack]
                                    formula="number = 1"
                                [/has_attack]
                            [/have_unit]
                        [/not]
                    [/and]
                [/or]
                [or]
                    [not]
                        [have_unit]
                            x,y=$x1,$y1
                            [has_attack]
                                formula="number < 3"
                            [/has_attack]
                        [/have_unit]
                    [/not]
                [/or]
                [then]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/then]
                [else]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_firststrike_object
                            duration=forever
                            [effect]
                                apply_to=attack
                                [set_specials]
                                    mode=append
                                    #textdomain wesnoth-help
                                    [firststrike]
                                        id=firststrike
                                        name= "<i>"+_"first strike"+"</i>"
                                        description= _ "This unit always strikes first with this attack, even if they are defending."
                                        special_note={INTERNAL:SPECIAL_NOTES_FIRSTSTRIKE}
                                    [/firststrike]
                                [/set_specials]
                            [/effect]
                        [/object]
                        #textdomain aww
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"Firststrike" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Firststrike"
                    [/message]
                [/else]
            [/if]
        [/case]
        [case]
            value=9
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    [has_attack]
                        special_type=poison
                    [/has_attack]
                [/have_unit]
                [or]
                    [have_unit]
                        x,y=$x1,$y1
                        [has_attack]
                            special_type=damage
                        [/has_attack]
                    [/have_unit]
                [/or]
                [or]
                    [not]
                        [have_unit]
                            x,y=$x1,$y1
                            [has_attack]
                                type=pierce,blade
                            [/has_attack]
                        [/have_unit]
                    [/not]
                [/or]
                [then]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/then]
                [else]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_poison_object
                            duration=forever
                            [effect]
                                apply_to=attack
                                type=pierce,blade
                                [set_specials]
                                    mode=append
                                    #textdomain wesnoth-help
                                    [poison]
                                        id=poison
                                        name= _ "<i>"+_"poison"+"</i>"
                                        description= _ "This attack poisons living targets. Poisoned units lose 8 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit."
                                        special_note={INTERNAL:SPECIAL_NOTES_POISON}
                                    [/poison]
                                [/set_specials]
                            [/effect]
                        [/object]
                        #textdomain aww
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"Poison" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Poisonous bladed or pierced weapons"
                    [/message]
                [/else]
            [/if]
        [/case]
        [case]
            value=16
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    [has_attack]
                        special_type=drains
                    [/has_attack]
                [/have_unit]
                [or]
                    [have_unit]
                        x,y=$x1,$y1
                        [has_attack]
                            special_type=heal_on_hit
                        [/has_attack]
                    [/have_unit]
                [/or]
                [or]
                    [not]
                        [have_unit]
                            x,y=$x1,$y1
                            [has_attack]
                                range=melee
                                formula="number > 3"
                            [/has_attack]
                        [/have_unit]
                    [/not]
                [/or]
                [then]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/then]
                [else]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_adrenaline_object
                            duration=forever
                            {AWW_ATTACK_EFFECT_ADRENALINE}
                        [/object]
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"Adrenaline" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Adrenaline"+" +4"
                    [/message]
                [/else]
            [/if]
        [/case]
        [case]
            value=10,14,19,20
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    upkeep=loyal
                [/have_unit]
                [or]
                    [have_unit]
                        x,y=$x1,$y1
                        canrecruit=yes
                    [/have_unit]
                [/or]
                [or]
                    [have_unit]
                        x,y=$x1,$y1
                        level=0,1,2
                    [/have_unit]
                [/or]
                [then]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/then]
                [else]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        #textdomain wesnoth-help
                        [trait]
                            id=aww_amla_loyal
                            male_name= "<i>"+_"loyal"+"</i>"
                            female_name= "<i>"+_"female^loyal"+"</i>"
                            description= _ "Zero upkeep"
                            help_text= _ "<italic>text='Loyal'</italic> units don’t incur upkeep. Most units incur an upkeep cost at the end of every turn, which is equal to their level. Loyal units do not incur this cost."
                            [effect]
                                apply_to=loyal
                            [/effect]
                            [effect]
                                apply_to=overlay
                                add="misc/loyal-icon.png"
                            [/effect]
                        [/trait]
                    [/modify_unit]
                    #textdomain wesnoth-lib
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"Loyal" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        male_message= _ "Loyal"
                        female_message= _ "female^Loyal"
                    [/message]
                [/else]
            [/if]
        [/case]
        [case]
            value=13
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    trait=fearless
                [/have_unit]
                [or]
                    [have_unit]
                        x,y=$x1,$y1
                        trait=aww_amla_fearless
                    [/have_unit]
                [/or]
                [or]
                    [have_unit]
                        x,y=$x1,$y1
                        formula="alignment = neutral"
                    [/have_unit]
                [/or]
                [or]
                    [have_unit]
                        x,y=$x1,$y1
                        ability_type=illuminates
                    [/have_unit]
                [/or]
                [then]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/then]
                [else]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        #textdomain wesnoth-help
                        [trait]
                            id=aww_amla_fearless
                            male_name= "<i>"+_"fearless"+"</i>"
                            female_name= "<i>"+_"female^fearless"+"</i>"
                            description= _ "Fights normally during unfavorable times of day/night"
                            help_text= _ "Aversion to light and dark holds no sway over these brave individuals."
                            [effect]
                                apply_to="fearless"
                            [/effect]
                        [/trait]
                    [/modify_unit]
                    #textdomain aww
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"Fearless" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        male_message= _ "Fearless"
                        female_message= _ "female^Fearless"
                    [/message]
                [/else]
            [/if]
        [/case]
        [case]
            value=24
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    [has_attack]
                        special_type=damage
                    [/has_attack]
                [/have_unit]
                [or]
                    [not]
                        [have_unit]
                            x,y=$x1,$y1
                            [has_attack]
                                range=melee
                                type=blade,pierce
                            [/has_attack]
                        [/have_unit]
                    [/not]
                [/or]
                [then]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/then]
                [else]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_backstab_object
                            duration=forever
                            [effect]
                                apply_to=attack
                                range=melee
                                type=blade,pierce
                                [set_specials]
                                    mode=append
                                    ## important to append to cumulate with charge and others specials
                                    [damage]
                                        id=backstab
                                        #textdomain wesnoth-help
                                        name="<i>"+_"backstab"+"</i>"
                                        #textdomain aww
                                        description= _ "When used offensively, this attack deals 50% more damage if there is an enemy of the target on the opposite side of the target, and that unit is not incapacitated (turned to stone or otherwise paralyzed)."
                                        special_note={INTERNAL:SPECIAL_NOTES_BACKSTAB}
                                        multiply=1.5
                                        active_on=offense
                                        [filter_opponent]
                                            formula="
												enemy_of(self, flanker) and not flanker.petrified
											where
												flanker = unit_at(direction_from(loc, other.facing))
											"
                                        [/filter_opponent]
                                    [/damage]
                                [/set_specials]
                            [/effect]
                        [/object]
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"Backstab" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Melee backstab on blade or pierce weapons"
                    [/message]
                [/else]
            [/if]
        [/case]
        [case]
            value=29,22
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    [has_attack]
                        special_type=chance_to_hit
                    [/has_attack]
                [/have_unit]
                [or]
                    [not]
                        [have_unit]
                            x,y=$x1,$y1
                            [has_attack]
                                range=ranged
                            [/has_attack]
                        [/have_unit]
                    [/not]
                [/or]
                [then]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/then]
                [else]
                    [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_marksman_object
                            duration=forever
                            [effect]
                                apply_to=attack
                                range=ranged
                                #textdomain wesnoth-help
                                [set_specials]
                                    mode=append
                                    [chance_to_hit]
                                        id=marksman
                                        name= "<i>"+_"marksman"+"</i>"
                                        description= _ "When used offensively, this attack always has at least a 60% chance to hit."
                                        special_note={INTERNAL:SPECIAL_NOTES_MARKSMAN}
                                        value=60
                                        cumulative=yes
                                        active_on=offense
                                    [/chance_to_hit]
                                [/set_specials]
                            [/effect]
                        [/object]
                        #textdomain aww
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"Marksman" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Minimum accuracy of 60% for ranged weapons"
                    [/message]
                [/else]
            [/if]
        [/case]
        [case]
            value=30,31
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    [has_attack]
						type=cold
                    [/has_attack]
                [/have_unit]
                [and]
                    [not]
                        [have_unit]
                            x,y=$x1,$y1
                            [has_attack]
								special_type=slow
                            [/has_attack]
                        [/have_unit]
                    [/not]
                [/and]
                [then]
                   [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_slows_object
                            duration=forever
                            [effect]
                                apply_to=attack
                                type=cold
                                #textdomain wesnoth-help
                                [set_specials]
                                    mode=append
									[slow]
										id=slow
										name= "<i>"+_"slows"+"</i>"
										description= _ "This attack slows the target until it ends a turn. Slow halves the damage caused by attacks and the movement cost for a slowed unit is doubled. A unit that is slowed will feature a snail icon in its sidebar information when it is selected."
										special_note={INTERNAL:SPECIAL_NOTES_SLOW}
									[/slow]
                                [/set_specials]
                            [/effect]
                        [/object]
                        #textdomain aww
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"Slows" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Slows on cold type attacks"
                    [/message]
                [/then]
                [else]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/else]
            [/if]
        [/case]
        [case]
            value=32,33
            [if]
                [have_unit]
                    x,y=$x1,$y1
					ability_type=hides
					[not]
						ability=aww_ability_camouflage
					[/not]
                [/have_unit]
                [then]
                   [modify_unit]
                        {AWW_EMBEDDED_FILTER_EVENT_UNIT}
                        [object]
                            id=aww_amla_camouflage_object
                            duration=forever
							[effect]
								apply_to=remove_ability
								[abilities]
									{ABILITY_AMBUSH}
								[/abilities]
							[/effect]
							[effect]
								apply_to=remove_ability
								[abilities]
									{ABILITY_CONCEALMENT}
								[/abilities]
							[/effect]
							[effect]
								apply_to=remove_ability
								[abilities]
									{ABILITY_SUBMERGE}
								[/abilities]
							[/effect]
							[effect]
								apply_to=remove_ability
								[abilities]
									{ABILITY_NIGHTSTALK}
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									{AWW_ABILITY_CAMOUFLAGE}
								[/abilities]
							[/effect]
                        [/object]
                    [/modify_unit]
                    {AWW_FLOAT_TEXT_SCROLL $x1 $y1 _"Camouflage" {AWW_COLOR_AMLA}}
                    [message]
                        speaker=unit
                        message= _ "Camouflage"
                    [/message]
                [/then]
                [else]
                    [fire_event]
                        name=aww_09_bonus_selection
                        [primary_unit]
                            x,y=$x1,$y1
                        [/primary_unit]
                    [/fire_event]
                [/else]
            [/if]
        [/case]
    [/switch]

    {CLEAR_VARIABLE rand_bonus}
[/event]

## To disable earned abilities :
[event]
    name=aww_event_09_disable
    id=aww_09_trigger_disable
    first_time_only=no
    [filter_condition]
        [not]
            {AWW_ENABLED_FEATURE_09}
        [/not]
    [/filter_condition]

    [aww_remove_object]
        object_id=aww_amla_leadership_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_distract_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_regen_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_firststrike_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_poison_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_adrenaline_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_melee_damage_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_ranged_damage_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_melee_strike_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_ranged_strike_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_movement_points_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_backstab_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_marksman_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_slows_object
    [/aww_remove_object]
    [aww_remove_object]
        object_id=aww_amla_camouflage_object
    [/aww_remove_object]
	[aww_remove_object]
        object_id=aww_amla_icon_overlay
    [/aww_remove_object]
    [aww_remove_trait]
        trait_id=aww_amla_loyal
    [/aww_remove_trait]
    [aww_remove_trait]
        trait_id=aww_amla_fearless
    [/aww_remove_trait]

    [remove_unit_overlay]
        image=misc/aww-leader-bonus-bronze.png
    [/remove_unit_overlay]

    [modify_unit]
        [filter]
            [filter_wml]
                [variables]
                    aww_amla_has_leadership=yes
                [/variables]
            [/filter_wml]
        [/filter]
        [set_variable]
            name=aww_amla_has_leadership
            value=no
        [/set_variable]
    [/modify_unit]
[/event]
